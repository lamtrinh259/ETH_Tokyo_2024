# Zeto toolkit golang library

Golang implementation of Sparse Merkle Tree that is optimized for managing an append-only tree, and is able to generate proofs to be used as private inputs to a circom-based proof generator. The project also includes an end-to-end integration test that demonstrates how to use the go-rapidsnark library to generate zkSNARK proofs with WASM based circuit runtimes.

## Running the unit tests for the Spark Merkle Tree implementation

```console
$ go test ./internal/node ./internal/smt ./internal/storage ./internal/utxo
?   	github.com/hyperledger-labs/zeto/internal/storage	[no test files]
ok  	github.com/hyperledger-labs/zeto/internal/node	0.828s
ok  	github.com/hyperledger-labs/zeto/internal/smt	1.037s
ok  	github.com/hyperledger-labs/zeto/internal/utxo	1.269s
```

## Running the integration test

The project does NOT contain some of the cryptographic materials to perform proof generations and verifications, such as the proving keys and the verification keys. You must run the [build steps](/zkp/js/README.md#build) before you can run the tests.

> You do NOT need to re-compile the circuits. Start with the step to [Generate the proving key](/zkp/js/README.md#generate-the-proving-key).

Once the proving keys and verification keys are generated, set the following environment variables

- `CIRCUITS_ROOT`: the folder that contains the WASM runtime for the circuits that are generated by the circom compiler. If you do not want to compile the circtuis yourself, a copy of them are included in the `js/lib` folder
- `PROVING_KEYS_ROOT`: the folder that contains the proving keys and verification keys

Note: you need to be running a postgres database locally before running the tests, you can run it in Docker with:
```console
docker run -d --name postgres -e POSTGRES_PASSWORD=my-secret -p 5432:5432 postgres
```

```console
$ go test -v ./integration-test/
=== RUN   TestZeto_1_SuccessfulProving
Proving time: 201.09225ms
--- PASS: TestZeto_1_SuccessfulProving (0.58s)
=== RUN   TestZeto_2_SuccessfulProving
Proving time: 404.013542ms
--- PASS: TestZeto_2_SuccessfulProving (0.69s)
=== RUN   TestZeto_3_SuccessfulProving
Proving time: 2.30433175s
--- PASS: TestZeto_3_SuccessfulProving (2.61s)
=== RUN   TestHashTokenUri
--- PASS: TestHashTokenUri (0.00s)
=== RUN   TestZeto_4_SuccessfulProving
Proving time: 129.8345ms
--- PASS: TestZeto_4_SuccessfulProving (0.46s)
=== RUN   TestZeto_5_SuccessfulProving
Proving time: 1.126922875s
--- PASS: TestZeto_5_SuccessfulProving (1.64s)
PASS
ok  	github.com/kaleido-io/zeto/lib	6.324s
```
